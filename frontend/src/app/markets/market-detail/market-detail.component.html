<div class="container mx-auto px-4 py-8">
  <!-- Estado de carga -->
  <div *ngIf="isLoading" class="flex justify-center items-center py-16">
    <mat-spinner diameter="50"></mat-spinner>
    <p class="ml-4 text-lg text-gray-600 dark:text-gray-300">Cargando detalles del mercado...</p>
  </div>

  <!-- Mensaje de inicialización requerida -->
  <div *ngIf="!isLoading && !isInitialized" class="bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded-xl p-6 max-w-2xl mx-auto">
    <div class="flex items-center mb-4">
      <mat-icon class="text-amber-500 dark:text-amber-400 mr-2 text-3xl">warning</mat-icon>
      <h2 class="text-xl font-bold text-amber-700 dark:text-amber-300">Inicialización Requerida</h2>
    </div>
    <p class="mb-6 text-amber-700 dark:text-amber-300">Los mercados no han sido inicializados. Debes inicializarlos primero desde la pantalla de listado de mercados.</p>
    <button mat-button [routerLink]="['/markets']" class="bg-white dark:bg-slate-800 text-amber-600 dark:text-amber-300 hover:bg-amber-50 dark:hover:bg-amber-900/50 px-4 py-2 rounded-lg flex items-center">
      <mat-icon class="mr-2">arrow_back</mat-icon> Volver a Mercados
    </button>
  </div>

  <!-- Manejo de errores -->
  <div *ngIf="error" class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-xl p-6 max-w-2xl mx-auto">
    <div class="flex items-center mb-4">
      <mat-icon class="text-red-500 dark:text-red-400 mr-2 text-3xl">error_outline</mat-icon>
      <h2 class="text-xl font-bold text-red-700 dark:text-red-300">Error</h2>
    </div>
    <p class="mb-6 text-red-700 dark:text-red-300">{{ error }}</p>
    <button mat-button [routerLink]="['/markets']" class="bg-white dark:bg-slate-800 text-red-600 dark:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/50 px-4 py-2 rounded-lg flex items-center">
      <mat-icon class="mr-2">arrow_back</mat-icon> Volver a Mercados
    </button>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!isLoading && !error && isInitialized && stock">
    <!-- Navegación superior -->
    <div class="mb-6">
      <button (click)="goBack()" class="cursor-pointer flex items-center text-gray-700 dark:text-gray-300 hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors">
        <mat-icon class="mr-2">arrow_back</mat-icon> Volver a Mercados
      </button>
    </div>
    
    <!-- Cabecera del mercado -->
    <div class="border-2 border-emerald-200 dark:border-slate-700 bg-white dark:bg-slate-800 rounded-xl shadow-lg overflow-hidden mb-8">
      <!-- Banner superior con gradiente -->
      <div class="h-32 bg-gradient-to-r from-emerald-600 to-emerald-800 dark:from-emerald-700 dark:to-emerald-900 relative">
        <div class="absolute inset-0 overflow-hidden opacity-30">
          <svg class="w-full h-full text-white" viewBox="0 0 800 200" xmlns="http://www.w3.org/2000/svg">
            <path d="M800 200V0L400 200M0 200V0l400 200" fill="currentColor" fill-opacity="0.4" />
          </svg>
        </div>
        <div class="container mx-auto h-full flex items-center px-6 relative z-10">
          <div class="flex items-center">
            <div *ngIf="stock.logo" class="h-16 w-16 bg-white rounded-full p-2 mr-4 shadow-lg flex-shrink-0">
              <img [src]="stock.logo" [alt]="stock.name_market" class="w-full h-full object-contain">
            </div>
            <div>
              <h1 class="text-3xl md:text-4xl font-bold text-white">{{ stock.name_market }}</h1>
              <p class="text-emerald-100 text-lg">{{ stock.country_region }}</p>
            </div>
            <div class="ml-auto">
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm" 
                [ngClass]="{
                  'bg-green-100 text-green-800': stock.is_open,
                  'bg-red-100 text-red-800': !stock.is_open
                }">
                <span class="w-2 h-2 rounded-full mr-1"
                  [ngClass]="{'bg-green-500': stock.is_open, 'bg-red-500': !stock.is_open}"></span>
                {{ getStatusLabel(stock.is_open) }}
              </span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Información principal del mercado -->
      <div class="px-6 py-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-4">Información del mercado</h2>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-gray-600 dark:text-gray-400">Código MIC</span>
                <span class="font-mono text-emerald-600 dark:text-emerald-400">{{ stock.mic }}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-gray-600 dark:text-gray-400">Horario de operación</span>
                <span>{{ stock.opening_time }} - {{ stock.closing_time }}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-gray-600 dark:text-gray-400">Días de operación</span>
                <span>{{ stock.days_operation }}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-gray-600 dark:text-gray-400">País/Región</span>
                <span>{{ stock.country_region }}</span>
              </div>
            </div>
          </div>
          
          <div *ngIf="marketClock">
            <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-4">Estado actual</h2>
            <div class="bg-gray-50 dark:bg-slate-700 p-4 rounded-lg">
              <div class="flex items-center mb-3">
                <div class="w-3 h-3 rounded-full mr-2" 
                     [ngClass]="{'bg-green-500': marketClock.is_open, 'bg-red-500': !marketClock.is_open}"></div>
                <span class="font-medium" 
                      [ngClass]="{'text-green-600 dark:text-green-400': marketClock.is_open, 'text-red-600 dark:text-red-400': !marketClock.is_open}">
                  {{ marketClock.is_open ? 'Mercado abierto' : 'Mercado cerrado' }}
                </span>
              </div>
              
              <div *ngIf="marketClock.is_open" class="mb-2">
                <div class="text-sm text-gray-600 dark:text-gray-400">Cierra:</div>
                <div class="font-medium">{{ marketClock.next_close | date:'EEEE, d MMMM, HH:mm' }}</div>
              </div>
              
              <div *ngIf="!marketClock.is_open" class="mb-2">
                <div class="text-sm text-gray-600 dark:text-gray-400">Próxima apertura:</div>
                <div class="font-medium">{{ marketClock.next_open | date:'EEEE, d MMMM, HH:mm' }}</div>
              </div>
              
              <div class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                Última actualización: {{ marketClock.timestamp | date:'HH:mm:ss' }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Lista de acciones disponibles -->
    <div class="mt-8">
      <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-6">Acciones disponibles en {{ stock.name_market }}</h2>
      
      <!-- Estado de carga para acciones -->
      <div *ngIf="isLoadingShares" class="flex justify-center items-center py-8">
        <mat-spinner diameter="40" color="accent"></mat-spinner>
        <p class="ml-4 text-gray-600 dark:text-gray-400">Cargando acciones...</p>
      </div>
      
      <!-- Error al cargar acciones -->
      <div *ngIf="sharesError" class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6">
        <div class="flex items-center">
          <mat-icon class="text-red-500 dark:text-red-400 mr-2">warning</mat-icon>
          <p class="text-red-700 dark:text-red-300">{{ sharesError }}</p>
        </div>
      </div>
      
      <!-- Sin acciones disponibles -->
      <div *ngIf="!isLoadingShares && !sharesError && shares.length === 0" class="bg-gray-50 dark:bg-slate-700 rounded-lg p-8 text-center">
        <mat-icon class="text-gray-400 dark:text-gray-500 text-5xl mb-3">sentiment_dissatisfied</mat-icon>
        <h3 class="text-xl font-medium text-gray-700 dark:text-gray-300 mb-2">No hay acciones disponibles</h3>
        <p class="text-gray-600 dark:text-gray-400">No se encontraron acciones para este mercado.</p>
      </div>
      
      <!-- Lista de acciones -->
      <div *ngIf="!isLoadingShares && !sharesError && shares.length > 0">
        <!-- Acciones destacadas -->
        <div class="mb-8" *ngIf="featuredShares.length > 0">
          <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4">Acciones destacadas</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            <div *ngFor="let share of featuredShares" class="bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-xl shadow-sm hover:shadow-md transition-shadow p-4">
              <div class="flex justify-between items-start mb-3">
                <h4 class="font-bold">{{ share.symbol }}</h4>
                <span class="text-xs px-2 py-1 rounded-full bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-300">{{ share.class }}</span>
              </div>
              <p class="text-gray-700 dark:text-gray-300 font-medium mb-2">{{ share.name_share }}</p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Sector: {{ share.sector }}</p>
              <div *ngIf="shareQuotes[share.symbol]" class="flex items-center mb-4">
                <span class="text-lg font-semibold text-gray-800 dark:text-gray-200">
                  {{ shareQuotes[share.symbol]!.price | currency:'USD' }}
                </span>
                <span [ngClass]="{'text-green-600': shareQuotes[share.symbol]!.changePercent >= 0, 'text-red-600': shareQuotes[share.symbol]!.changePercent < 0}" class="ml-2 text-sm">
                  {{ shareQuotes[share.symbol]!.changePercent | number:'1.2-2' }}%
                </span>
              </div>
              <div class="flex justify-between">
                <button mat-stroked-button color="primary" (click)="navigateToShareDetail(share)" class="text-xs">
                  Ver detalles
                </button>
                <button mat-flat-button color="accent" (click)="buyShare(share)" [disabled]="!stock.is_open" class="text-xs">
                  Comprar
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Tabla completa de acciones -->
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg">
            <thead class="bg-gray-100 dark:bg-slate-700">
              <tr>
                <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Símbolo</th>
                <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Nombre</th>
                <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Clase</th>
                <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Sector</th>
                <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Estado</th>
                <th class="py-3 px-4 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Acciones</th>
              </tr>
            </thead>
            <tbody>              <tr *ngFor="let share of shares" class="border-t border-gray-200 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors">
                <td class="py-3 px-4 font-medium">{{ share.symbol }}</td>
                <td class="py-3 px-4">{{ share.name_share }}</td>
                <td class="py-3 px-4">{{ share.class }}</td>
                <td class="py-3 px-4">{{ share.sector }}</td>
                <td class="py-3 px-4">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" 
                        [ngClass]="{'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400': share.status, 
                        'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400': !share.status}">
                    {{ share.status ? 'Activa' : 'Inactiva' }}
                  </span>
                </td>                <td class="py-2 px-4 text-right">
                  <button mat-icon-button color="primary" (click)="navigateToShareDetail(share)" matTooltip="Ver detalles">
                    <mat-icon>visibility</mat-icon>
                  </button>
                  <button mat-icon-button color="accent" (click)="buyShare(share)" [disabled]="!stock.is_open || !share.tradable" matTooltip="Comprar acción">
                    <mat-icon>shopping_cart</mat-icon>
                  </button>
                  <button mat-icon-button color="warn" (click)="sellShare(share)" [disabled]="!stock.is_open || !share.tradable" matTooltip="Vender acción">
                    <mat-icon>sell</mat-icon>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
</div>